{% set cartData = app.session.get('cartData') %}
{% set cartItems = [] %}

{% if cartData and cartData.products is defined %}
    {% for element in cartData.products %}
        {% set cartItems = cartItems|merge([{ 
            id: element.product.id,
            name: element.product.name,
            image: element.product.image,
            quantity: element.quantity,
            price: element.product.price,
            deleteUrl: path('cart_delete', {'id': element.product.id})
        }]) %}
    {% endfor %}
{% endif %}

{% set cartCount = 0 %}
{% set cartSubtotal = 0 %}

{% if cartData and cartData.data is defined %}
    {% set cartCount = cartData.data.quantity_cart|default(0) %}
    {% set cartSubtotal = cartData.data.subTotalTTC|default(0) %}
{% endif %}

{% set userProps = app.user ? {
    isAuthenticated: true,
    authenticatedLinks: [
        { label: 'Comparer', href: '#', icon: 'ti-control-shuffle' },
        { label: 'Liste de souhaits', href: '#', icon: 'ti-heart' },
        { label: 'Mon compte', href: path('account'), icon: 'ti-user' },
        { label: 'Deconnexion', href: path('app_logout'), icon: 'fas fa-sign-out-alt' }
    ],
    guestLinks: []
} : {
    isAuthenticated: false,
    authenticatedLinks: [],
    guestLinks: [
        { label: 'Connexion', href: path('app_login'), icon: 'ti-user' },
        { label: 'Inscription', href: path('app_register'), icon: 'fas fa-sign-in-alt' }
    ]
} %}

{% set headerProps = {
    brandUrl: path('home'),
    logos: {
        light: '/assets/images/logo_light.png',
        dark: '/assets/images/logo_dark.png'
    },
    languages: [
        { value: 'fn', label: 'France', image: '/assets/images/fn.png' },
        { value: 'en', label: 'English', image: '/assets/images/eng.png' },
        { value: 'us', label: 'United States', image: '/assets/images/us.png' }
    ],
    currencies: [
        { value: 'EUR', label: 'EUR' },
        { value: 'USD', label: 'USD' },
        { value: 'GBR', label: 'GBR' }
    ],
    defaultLanguage: 'fn',
    defaultCurrency: 'EUR',
    contactNumber: '00-00-00-00-00',
    navLinks: [
        { label: 'Accueil', href: path('home'), itemClass: 'dropdown', linkClass: 'nav-link' },
        { label: 'Boutique', href: path('shop'), itemClass: '', linkClass: 'nav-link' },
        { label: 'Nous contacter', href: '#', itemClass: '', linkClass: 'nav-link nav_item' }
    ],
    user: userProps,
    search: {
        endpoint: path('search_suggestions'),
        placeholder: 'Rechercher un produit',
        action: path('product_search'),
        inputName: 'q'
    },
    cart: {
        items: cartItems,
        count: cartCount,
        subtotal: cartSubtotal,
        currencyCode: 'EUR',
        cartUrl: path('cart'),
        checkoutUrl: path('checkout')
    }
} %}

{% set headerPropsJson = headerProps|json_encode(constant('JSON_UNESCAPED_UNICODE')) %}

<div id="react-header-root" data-props="{{ headerPropsJson|e('html_attr') }}"></div>
